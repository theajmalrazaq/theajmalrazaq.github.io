---
import { supabase } from "../../lib/supabaseClient";
import ProjectCard from "./subcomponents/ProjectCard.astro";
import Button from "../Button.astro";
import { ChevronRight } from "@lucide/astro";
// Define valid project tab types
type ProjectTabName =
  | "selected_web_projects"
  | "selected_ui_projects"
  | "selected_graphics_projects";

// Props with type annotation
const { activeTab = "selected_web_projects" } = Astro.props as {
  activeTab?: ProjectTabName;
};

// Fetch data for each tab statically at build time
const webProjects = await supabase.from("selected_web_projects").select("*");
const uiProjects = await supabase.from("selected_ui_projects").select("*");
const graphicsProjects = await supabase
  .from("selected_graphics_projects")
  .select("*");

// Handle potential errors
if (webProjects.error) console.error("Supabase error:", webProjects.error);
if (uiProjects.error) console.error("Supabase error:", uiProjects.error);
if (graphicsProjects.error)
  console.error("Supabase error:", graphicsProjects.error);

// Create a map of project types to their data
const projectsData = {
  selected_web_projects: webProjects.data || [],
  selected_ui_projects: uiProjects.data || [],
  selected_graphics_projects: graphicsProjects.data || [],
};
---

<section
  class="relative mt-40 w-full sm:px-15 px-6 flex flex-col items-center justify-center gap-5"
  data-aos="focus-up"
  data-aos-duration="1200"
  id="projects"
  role="region"
  aria-labelledby="projects-heading"
>
  <img
    src="images/Projects.svg"
    alt="Projects section decorative illustration"
    class="absolute sm:w-1/3 w-67 sm:-top-15 -top-7 duration-1000 ease-in-out"
    id="projecticons"
    data-aos="focus-up"
    data-aos-duration="1000"
    aria-hidden="true"
  />

  <div class="relative flex flex-col items-center justify-center gap-3 w-full">
    <h1
      class="text-white text-3xl sm:text-5xl md:text-7xl font-nixel trackig-[1px] flex gap-2 text-center"
      data-aos="focus-up"
      data-aos-duration="1200"
      id="projects-heading"
    >
      <div>projects</div>
      <div>that</div>
      <div class="text-accent">i</div>
      <div>have</div>
      <div>worked</div>
      <div class="text-accent">on</div>
    </h1>

    <p
      class="font-product-sans text-sm text-center text-white/90"
      data-aos="focus-up"
      data-aos-duration="1000"
    >
      Here's a collection of work where I turned pain points into purposeful
      products through <br />
      <span class="text-accent"
        >careful research, intuitive design, and scalable development.</span
      >
    </p>
  </div>
  <lottie-player
    src="animations/projectsicon.json"
    background="transparent"
    id="firstLottie"
    class="sm:top-10 h-1/2 w-[90%] sm:w-1/2 z-10"
    data-aos="focus-up"
    data-aos-duration="1000"
  >
  </lottie-player>

  <div
    class="flex flex-col items-center justify-center gap-8 w-full rounded-4xl"
  >
    <div
      class="shadow-accent backdrop-blur-lg text-sm font-product-sans text-white border border-white/10 w-fit rounded-full z-99 mt-4 flex justify-center gap-2 p-2 flex-wrap"
      data-aos="focus-up"
      data-aos-duration="1000"
    >
      <div
        class={`px-4  py-2 rounded-full cursor-pointer transition-all duration-300 ease-in-out  ${
          activeTab === "selected_web_projects"
            ? "shadow-accent"
            : "bg-transparent"
        }`}
        data-tab="selected_web_projects"
      >
        <span class="hidden sm:inline">Web Project</span>
        <span class="sm:hidden">Web</span>
      </div>
      <div
        class={`px-4  py-2 rounded-full cursor-pointer transition-all duration-300 ease-in-out  ${
          activeTab === "selected_ui_projects"
            ? "shadow-accent"
            : "bg-transparent"
        }`}
        data-tab="selected_ui_projects"
      >
        <span class="hidden sm:inline">UI/UX Projects</span>
        <span class="sm:hidden">UI/UX</span>
      </div>
      <div
        class={`px-4 py-2 rounded-full cursor-pointer transition-all duration-300 ease-in-out  ${
          activeTab === "selected_graphics_projects"
            ? "shadow-accent"
            : "bg-transparent"
        }`}
        data-tab="selected_graphics_projects"
      >
        <span class="hidden sm:inline">Graphics Design Projects</span>
        <span class="sm:hidden">Graphics</span>
      </div>
    </div>

    <!-- Web Projects -->
    <div
      id="selected_web_projects"
      class={`transition-all duration-500 ease-in-out flex sm:flex-row flex-col gap-5  ${activeTab === "selected_web_projects" ? "block" : "hidden"}`}
    >
      {
        projectsData.selected_web_projects.map((project, index) => (
          <div style={`animation-delay: ${index * 100}ms`}>
            <ProjectCard project={project} />
          </div>
        ))
      }
    </div>

    <!-- UI Projects -->
    <div
      id="selected_ui_projects"
      class={` transition-all duration-500 ease-in-out flex sm:flex-row flex-col gap-5 ${activeTab === "selected_ui_projects" ? "block" : "hidden"}`}
    >
      {
        projectsData.selected_ui_projects.map((project, index) => (
          <div style={`animation-delay: ${index * 100}ms`}>
            <ProjectCard project={project} />
          </div>
        ))
      }
    </div>

    <!-- Graphics Projects -->
    <div
      id="selected_graphics_projects"
      class={` transition-all duration-500 ease-in-out flex sm:flex-row flex-col gap-5 ${activeTab === "selected_graphics_projects" ? "block" : "hidden"}`}
    >
      {
        projectsData.selected_graphics_projects.map((project, index) => (
          <div style={`animation-delay: ${index * 100}ms`}>
            <ProjectCard project={project} />
          </div>
        ))
      }
    </div>
    <Button
      text="view all"
      href="/projects"
      data_aos="focus-up"
      data_aos_duration="800"
      aria_label="View all projects"
    >
      <ChevronRight size="18" />
    </Button>
  </div>
</section>
