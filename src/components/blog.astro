---
import { supabase } from "../lib/supabaseClient";

// Fetch the 3 latest blogs from Supabase
const { data: blogs, error } = await supabase
  .from("blogs")
  .select("*")
  .order("created_at", { ascending: false })
  .limit(3);

// Handle potential errors
if (error) console.error("Supabase error:", error);
---

<section class="relative flex flex-col justify-center items-center w-full mt-25 mb-15 px-4 sm:px-15" id="featured-blogs">
     
      <img src="images/post.svg" alt="Projects section decorative illustration" class="absolute sm:w-1/5 w-36 sm:-top-10 -top-7 duration-1000 ease-in-out" id="projecticons" data-aos="text-focus-fade-up" data-aos-delay="100" data-aos-duration="800" aria-hidden="true" />
  <div class="flex flex-col items-center justify-center gap-3 w-full mb-8">
    <h1
      class="text-white text-3xl sm:text-5xl md:text-7xl z-10 font-nixel tracking-[1px] text-center flex gap-2 flex-wrap justify-center"
      data-aos="text-focus-fade-up"
      data-aos-delay="200"
      data-aos-duration="800"
    >
      <div>latest</div>
      <div class="text-accent">blog</div>
      <div>posts</div>
    </h1>
    
    <p
      class="font-product-sans text-sm text-center text-white/90 max-w-prose mx-auto leading-relaxed"
      data-aos="text-focus-fade-up"
      data-aos-delay="300"
      data-aos-duration="800"
    >
      Thoughts, tutorials, and insights on frontend development and design
    </p>
  </div>
<div class="flex m-auto flex-wrap justify-center items-center gap-4">
    {blogs && blogs.map((blog) => (
      <a
        href={`/blog/${blog.slug}`} 
        class="blog-card group  border-2 border-white/10  rounded-[0px]  overflow-hidden flex flex-col h-full  transition-all duration-300 ease-in-out group"
        data-aos="text-focus-fade-up"
      > 
        <div class="p-5 flex sm:flex-row flex-col-reverse justify-between gap-6">
          <div class="flex flex-col sm:w-1/2 w-full justify-between ">
            <div class="flex justify-between items-center text-xs text-white/60 mb-2">
              <span>{new Date(blog.created_at).toLocaleDateString('en-US', { month: 'long', day: '2-digit', year: 'numeric' })}</span>
              
            </div>
            <h2 class="text-2xl font-nixel tracking-[1px] text-white mb-2 group-hover:text-accent" style="word-spacing: -7px;">{blog.title}</h2>
            <p class="text-sm text-white/80 mb-4 line-clamp-3 flex-grow">{blog.excerpt}</p>
            <div class="flex justify-between items-center mt-auto pt-4 text-xs text-white/60 border-t border-white/10">
              <div class="flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4">
                  <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" />
                  <circle cx="12" cy="12" r="3" />
                </svg>
                <div class="flex items-center gap-6">
                   <span>{blog.views_count} views</span>
                <span>{blog.avg_read_time} min read</span>
                </div>
               
              </div>
             
            </div>
          </div>
          <img src={blog.img} alt={blog.title} class="sm:w-[200px] w-full aspect-video  transition-transform duration-500" />
        </div>
      </a>
    ))}
</div>
  
  {!blogs || blogs.length === 0 && (
    <div class="flex items-center justify-center h-48 text-white/60 text-center">
      <p>Coming soon! Check back for exciting content.</p>
    </div>
  )}
  
  <div class="flex justify-center mt-8">
    <a 
      href="/blog" 
      class="w-fit font-nixel tracking-[1px] text-white bg-black sm:px-3 px-3 py-2 border border-white/10 hover:border-white/30 backdrop-blur-2xl hover:scale-105 hover:shadow-lg hover:shadow-white/5 transition-all duration-300 ease-in-out cursor-pointer text-xl flex justify-center items-center gap-2 relative"
      data-aos="text-focus-fade-up"
    >
      <span class="relative z-10">view all posts</span>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-accent">
        <path d="m9 18 6-6-6-6"/>
      </svg>
    </a>
  </div>
</section>

