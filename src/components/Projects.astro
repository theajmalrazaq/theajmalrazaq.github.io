---
import { supabase } from "../lib/supabaseClient";
import ProjectCard from "./ProjectCard.astro";

// Define valid project tab types
type ProjectTabName = "selected_web_projects" | "selected_ui_projects" | "selected_graphics_projects";

// Props with type annotation
const { activeTab = "selected_web_projects" } = Astro.props as { activeTab?: ProjectTabName };

// Fetch data for each tab statically at build time
const webProjects = await supabase.from("selected_web_projects").select("*");
const uiProjects = await supabase.from("selected_ui_projects").select("*");
const graphicsProjects = await supabase.from("selected_graphics_projects").select("*");

// Handle potential errors
if (webProjects.error) console.error("Supabase error:", webProjects.error);
if (uiProjects.error) console.error("Supabase error:", uiProjects.error);
if (graphicsProjects.error) console.error("Supabase error:", graphicsProjects.error);

// Create a map of project types to their data
const projectsData = {
  "selected_web_projects": webProjects.data || [],
  "selected_ui_projects": uiProjects.data || [],
  "selected_graphics_projects": graphicsProjects.data || []
};
---

<section>
  <div class="flex flex-col items-center justify-center gap-8 p-3 w-full rounded-4xl" data-aos="fade-up">
    <div class=" bg-black backdrop-blur-lg text-sm font-product-sans text-white border border-white/10 w-fit rounded-[0px] z-99 mt-4 flex justify-center gap-1 sm:gap-2 p-1 sm:p-2 flex-wrap" data-aos="text-focus-fade-up">
      <div 
        class={`px-4  py-2 rounded-[0px] cursor-pointer transition-all duration-300 ease-in-out  ${
          activeTab === "selected_web_projects" ? "bg-accent" : "bg-white/10"
        }`} 
        data-tab="selected_web_projects"
        data-aos="text-focus-fade-up"
      >
        <span class="hidden sm:inline" data-aos="text-focus-fade-up">Web Project</span>
        <span class="sm:hidden" data-aos="text-focus-fade-up">Web</span>
      </div>
      <div 
        class={`px-4  py-2 rounded-[0px] cursor-pointer transition-all duration-300 ease-in-out  ${
          activeTab === "selected_ui_projects" ? "bg-accent" : "bg-white/10"
        }`} 
        data-tab="selected_ui_projects"
        data-aos="text-focus-fade-up"
      >
        <span class="hidden sm:inline">UI/UX Projects</span>
        <span class="sm:hidden">UI/UX</span>
      </div>
      <div 
        class={`px-4 py-2 rounded-[0px] cursor-pointer transition-all duration-300 ease-in-out  ${
          activeTab === "selected_graphics_projects" ? "bg-accent" : "bg-white/10"
        }`} 
        data-tab="selected_graphics_projects"
        data-aos="text-focus-fade-up"
      >
        <span class="hidden sm:inline">Graphics Design Projects</span>
        <span class="sm:hidden">Graphics</span>
      </div>
    </div>

    <!-- Web Projects -->
    <div id="selected_web_projects" class={`m-auto transition-all duration-500 ease-in-out flex sm:flex-row flex-col gap-5  ${activeTab === "selected_web_projects" ? "block" : "hidden"}`}>
      {projectsData.selected_web_projects.map((project, index) => (
        <div style={`animation-delay: ${index * 100}ms`}>
          <ProjectCard project={project} />
        </div>
      ))}
    </div>

    <!-- UI Projects -->
    <div id="selected_ui_projects" class={`m-auto transition-all duration-500 ease-in-out flex sm:flex-row flex-col gap-5 ${activeTab === "selected_ui_projects" ? "block" : "hidden"}`}>
      {projectsData.selected_ui_projects.map((project, index) => (
        <div style={`animation-delay: ${index * 100}ms`}>
          <ProjectCard project={project} />
        </div>
      ))}
    </div>

    <!-- Graphics Projects -->
    <div id="selected_graphics_projects" class={`m-auto transition-all duration-500 ease-in-out flex sm:flex-row flex-col gap-5 ${activeTab === "selected_graphics_projects" ? "block" : "hidden"}`}>
      {projectsData.selected_graphics_projects.map((project, index) => (
        <div style={`animation-delay: ${index * 100}ms`}>
          <ProjectCard project={project} />
        </div>
      ))}
    </div>

  </div>
</section>


